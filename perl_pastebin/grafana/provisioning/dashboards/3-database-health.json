{
  "annotations": { "list": [] }, "editable": true, "gnetId": null,
  "graphTooltip": 0, "panels": [
    { "title": "CouchDB Exporter Status", "type": "stat", "gridPos": { "h": 4, "w": 4, "x": 0, "y": 0 }, "id": 1,
      "targets": [{ "expr": "up{job=\"couchdb\"}", "refId": "A" }],
      "fieldConfig": { "defaults": {
        "thresholds": { "mode": "absolute", "steps": [{ "color": "red", "value": null }, { "color": "green", "value": 1 }] },
        "mappings": [{ "type": "value", "options": { "1": { "text": "UP", "color": "green" }, "0": { "text": "DOWN", "color": "red" } } }]
      }}
    },
    { "title": "Total Documents", "type": "stat", "gridPos": { "h": 4, "w": 5, "x": 4, "y": 0 }, "id": 2,
      "targets": [{ "expr": "couchdb_database_doc_count{job=\"couchdb\", db_name=\"pastes\"}", "legendFormat": "Documents", "refId": "A" }]
    },
    { "title": "Database Size on Disk", "type": "stat", "gridPos": { "h": 4, "w": 5, "x": 9, "y": 0 }, "id": 3,
      "targets": [{ "expr": "couchdb_database_disk_size{job=\"couchdb\", db_name=\"pastes\"}", "legendFormat": "Disk Size", "refId": "A" }],
      "fieldConfig": { "defaults": { "unit": "bytes" } }
    },
    { "title": "Data vs Disk Overhead", "description": "Показывает соотношение реального размера данных к общему размеру на диске. Большой overhead может указывать на необходимость компактификации.", "type": "gauge", "gridPos": { "h": 4, "w": 5, "x": 14, "y": 0 }, "id": 6,
      "targets": [{ "expr": "couchdb_database_data_size{job=\"couchdb\", db_name=\"pastes\"}", "legendFormat": "Data", "refId": "A" }, { "expr": "couchdb_database_disk_size{job=\"couchdb\", db_name=\"pastes\"}", "legendFormat": "Total Disk", "refId": "B" }],
      "options": { "reduceOptions": { "values": false, "calcs": ["lastNotNull"], "fields": "" }, "showThresholdLabels": false, "showThresholdMarkers": true },
      "fieldConfig": { "defaults": { "unit": "bytes" } }
    },
    { "title": "CouchDB Internal Request Time", "description": "Время обработки запроса внутри CouchDB (без учета сети).", "type": "timeseries", "gridPos": { "h": 8, "w": 24, "x": 0, "y": 4 }, "id": 7,
      "targets": [
        { "expr": "couchdb_httpd_request_time{job=\"couchdb\", metric=\"99\"}", "legendFormat": "p99", "refId": "A" },
        { "expr": "couchdb_httpd_request_time{job=\"couchdb\", metric=\"Median\"}", "legendFormat": "p50 (Median)", "refId": "B" }
      ],
      "fieldConfig": { "defaults": { "unit": "ms" } }
    },
    { "title": "Erlang VM Memory Usage", "type": "timeseries", "gridPos": { "h": 8, "w": 12, "x": 0, "y": 12 }, "id": 8,
      "options": { "legend": { "displayMode": "table", "placement": "right" }, "stacking": { "mode": "normal" } },
      "targets": [
        { "expr": "couchdb_erlang_memory_processes{job=\"couchdb\"}", "legendFormat": "Processes", "refId": "A" },
        { "expr": "couchdb_erlang_memory_code{job=\"couchdb\"}", "legendFormat": "Code", "refId": "B" },
        { "expr": "couchdb_erlang_memory_ets{job=\"couchdb\"}", "legendFormat": "ETS", "refId": "C" },
        { "expr": "couchdb_erlang_memory_binary{job=\"couchdb\"}", "legendFormat": "Binary", "refId": "D" },
        { "expr": "couchdb_erlang_memory_atom{job=\"couchdb\"}", "legendFormat": "Atom", "refId": "E" },
        { "expr": "couchdb_erlang_memory_other{job=\"couchdb\"}", "legendFormat": "Other", "refId": "F" }
      ],
      "fieldConfig": { "defaults": { "unit": "bytes" } }
    },
    { "title": "Authentication Cache Hit Ratio", "type": "timeseries", "gridPos": { "h": 8, "w": 12, "x": 12, "y": 12 }, "id": 9,
      "targets": [{
        "expr": "(couchdb_httpd_auth_cache_hits{job=\"couchdb\"} / (couchdb_httpd_auth_cache_hits{job=\"couchdb\"} + couchdb_httpd_auth_cache_misses{job=\"couchdb\"})) or on() vector(0)",
        "legendFormat": "Hit Ratio", "refId": "A"
      }],
      "fieldConfig": { "defaults": { "unit": "percentunit", "min": 0, "max": 1 } }
    }
  ],
  "folder": "Pastebin Service", "title": "3. Database Health", "uid": "pastebin-database-v6"
}